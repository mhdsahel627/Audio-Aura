{% extends 'admin/admin-base.html' %}
{% load static %}

{% block title %}Category edit{% endblock %}

{% block content %}
<style>
  .form-section{ background:#000; padding:2rem; border-radius:12px; }
  .image-upload{ border:2px dashed #666; border-radius:8px; padding:40px 20px; text-align:center; background:#1e1e1e; cursor:pointer; transition:border .3s; }
  .image-upload:hover{ border-color:#8855ff; }
  .image-upload.highlight{ border-color:#8855ff; background:#2a2a2a; }
  .btn-submit{ background:#7c5c5c; color:#fff; }
  .btn-submit:hover{ background:#5a4141; }
  .current-thumb{ display:inline-block; background:#141414; padding:8px; border-radius:10px; }
  .current-thumb img{ max-width:180px; border-radius:8px; }
</style>

<div class="container py-5">
  <h2 class="fw-bold mb-4">EDIT CATEGORY</h2>

  {% if messages %}
    <div class="mb-3">
      {% for m in messages %}<div class="alert alert-{{ m.tags }}">{{ m }}</div>{% endfor %}
    </div>
  {% endif %}

  <form class="form-section" method="POST" enctype="multipart/form-data">
    {% csrf_token %}

    <!-- Current image preview -->
    <div class="mb-3">
      <label class="form-label">Current Image</label><br>
      {% if cat.image %}
        <span class="current-thumb"><img src="{{ cat.image.url }}" alt="{{ cat.name }}"></span>
      {% else %}
        <span class="text-muted">No image</span>
      {% endif %}
    </div>

    <!-- Replace image -->
    <div class="mb-4">
      <label class="form-label">Replace Image (optional)</label>
      <input type="file" name="image" class="form-control mb-2" accept="image/*">
      <div class="image-upload" id="dropper">
        <svg xmlns="http://www.w3.org/2000/svg" width="40" height="40" fill="#9c8df0" stroke="#9c8df0" viewBox="0 0 16 16">
          <path d="M6.002 5.5a1.5 1.5 0 1 1-3 0 1.5 1.5 0 0 1 3 0"/>
          <path d="M2.002 1a2 2 0 0 0-2 2v10a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V3a2 2 0 0 0-2-2zm12 1a1 1 0 0 1 1 1v6.5l-3.777-1.947a.5.5 0 0 0-.577.093l-3.71 3.71-2.66-1.772a.5.5 0 0 0-.63.062L1.002 12V3a1 1 0 0 1 1-1z"/>
        </svg>
        <p>Drag and drop new image here, or click to select</p>
      </div>
      <div id="newPreview" class="mt-2"></div>
    </div>

    <!-- Name -->
    <div class="mb-4">
      <label for="categoryName" class="form-label">Category Name</label>
      <input type="text" id="categoryName" name="name" class="form-control" value="{{ cat.name }}" required>
    </div>

    <!-- Description -->
    <div class="mb-4">
      <label for="description" class="form-label">Description</label>
      <textarea id="description" name="description" class="form-control" rows="4">{{ cat.description }}</textarea>
    </div>

    <div class="d-flex flex-wrap gap-3 justify-content-end">
      <a href="{% url 'catogery' %}" class="btn btn-light">Cancel</a>
      <button type="submit" class="btn btn-submit">Save Changes</button>
    </div>
  </form>
</div>

<script>
  const dropArea = document.getElementById('dropper');
  const fileInput = document.querySelector("input[name='image']");
  const preview = document.getElementById('newPreview');

  dropArea.addEventListener('click', ()=> fileInput.click());

  ['dragenter','dragover','dragleave','drop'].forEach(ev=>{
    dropArea.addEventListener(ev, e=>{ e.preventDefault(); e.stopPropagation(); });
  });
  ['dragenter','dragover'].forEach(ev=>{
    dropArea.addEventListener(ev, ()=> dropArea.classList.add('highlight'));
  });
  ['dragleave','drop'].forEach(ev=>{
    dropArea.addEventListener(ev, ()=> dropArea.classList.remove('highlight'));
  });

  dropArea.addEventListener('drop', e=>{
    const files = e.dataTransfer.files;
    if (!files || !files[0]) return;
    fileInput.files = files;
    showPreview(files[0]);
  });
  fileInput.addEventListener('change', e=>{
    const f = e.target.files?.[0];
    if (f) showPreview(f);
  });

  function showPreview(file){
    const reader = new FileReader();
    reader.onload = ()=> preview.innerHTML = `<img src="${reader.result}" class="img-fluid rounded" style="max-width:200px">`;
    reader.readAsDataURL(file);
  }
</script>
{% endblock %}
