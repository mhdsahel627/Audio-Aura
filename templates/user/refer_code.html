{% extends "user/base.html" %}
{% load static %}
{% block title %}Refer & Earn{% endblock %}

{% block content %}
<style>
  /* reuse wishlist grid and offsets */
  .shell{max-width:1240px;margin:0 auto;padding:0 16px}
  .page-top{display:flex;align-items:center;justify-content:space-between;margin-bottom:14px;color:#fff;margin: 0px -89px 14px 306px;}
  .top-actions{display:flex;gap:10px}
  .pill{height:40px;padding:0 14px;border-radius:7px;border:1px solid #ffffff4d;background:#000;color:#fff;font-weight:900;text-decoration:none;display:inline-flex;align-items:center;gap:6px}

  .grid{display:grid;grid-template-columns:360px 1fr;gap:28px;align-items:start;margin: 0px -86px 0px -98px;}
  @media(max-width:1100px){.grid{grid-template-columns:1fr}}

  /* outer white panel with soft outer and inner shadows (matches expected) */
  .panel{
    border-radius:24px;background:#fff;padding:26px 26px 28px;
    box-shadow:
      0 18px 40px rgba(0,0,0,.35),                 /* outer drop */
      inset 0 2px 0 rgba(255,255,255,.9),          /* top inner sheen */
      inset 0 -3px 10px rgba(0,0,0,.06);           /* bottom inner recess */
  }

  /* inner content card */
  .card{
    border-radius:18px;border:1px solid #E5E7EB;background:#fff;
    padding:28px 22px;display:grid;gap:16px;place-items:center;
  }

  /* hero block exactly centered and tighter */
  .hero{
    width:min(520px, 90%);height:220px;border-radius:14px;
    margin-top:4px;margin-bottom:6px;
  }
  .hero img{
    width: 520px;
    height: 220px;
  }
  /* show fallback text if no image is provided */
  .hero.fallback{display:grid;place-items:center;color:#7c8596;font-weight:800}

  .headline{margin:2px 0 6px;color:#0f1115;font-weight:900;font-size:24px;text-align:center}

  .label{margin-top:0;font-size:12px;letter-spacing:.16em;color:#6b7280;text-align:center;font-weight:900}

  /* code chip closer to label; exact beige chip + subtle dashed border */
  .code-row{display:flex;align-items:center;gap:8px}
  .chip{
    background:#fff8e7;border:1.5px dashed #f1d9a0;border-radius:12px;
    height:46px;display:inline-flex;align-items:center;gap:10px;padding:0 16px;
  }
  .code{
    font: 900 18px ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace;
    letter-spacing:.06em;color:#18181b
  }
  .copy{
    display:inline-grid;place-items:center;width:38px;height:38px;border-radius:8px;border:1px solid #e5e7eb;
    background:#fff;color:#374151;cursor:pointer;transition:transform .08s ease, background .2s ease, color .2s ease;
  }
  .copy:hover{background:#f3f4f6}
  .copy:active{transform:scale(.96)}
  .copy.copied{background:#d1fae5;color:#065f46}

  /* long rounded CTA, same grey as mock and tighter vertical spacing */
  .cta{
    width:min(520px, 92%);height:54px;border:0;border-radius:14px;font-weight:800;font-size:18px;color:#fff;
    background:#6b7280;box-shadow:0 6px 14px rgba(0,0,0,.20);cursor:pointer;transition:filter .2s ease, transform .08s ease;margin-top:8px;
  }
  .cta:hover{filter:brightness(1.05)}
  .cta:active{transform:translateY(1px)}

  /* panel should scroll if content grows, but not show a visible scrollbar by default height */
  .scroll-fit{max-height:845px;overflow:auto}
  .scroll-fit::-webkit-scrollbar{width:8px}
  .scroll-fit::-webkit-scrollbar-thumb{background:#9aa5b1;border-radius:999px}
</style>

<section style="padding:30px 0 54px;background:radial-gradient(1200px 700px at 15% -10%, rgba(255,255,255,.06), transparent),linear-gradient(180deg,#16031f,#2a0830)">
  <div class="shell">
    <div class="page-top">
      <div>REFER & EARN</div>
      <div class="top-actions">
        <a href="{% url 'shop' %}" class="pill">Shop</a>
      </div>
    </div>

    <div class="grid">
     {% include "user/sidebar.html" with active_tab="refer" %}

      <div class="panel scroll-fit">
        <div class="card">
          <h2 class="title" style="letter-spacing:.06em;font-weight:900;font-size:18px;color:#111826;margin:0;">REFER & EARN</h2>


            <div class="hero">
                <img src="https://res.cloudinary.com/dxndvadjt/image/upload/v1765252921/referral-icon_xxh6ge.jpg" alt="">
            </div>


          <p class="headline">Refer now and Earn up to â‚¹100</p>

          <div class="label">REFERRAL CODE</div>


        <div class="code-row">
        <div class="chip">
            <span id="ref-code" class="code">{{ referral_code }}</span>
            <button id="copy-code" class="copy" type="button" aria-label="Copy referral code">
            <!-- your copy SVG -->
            <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"
                stroke-linecap="round" stroke-linejoin="round" aria-hidden="true">
                <rect x="9" y="9" width="13" height="13" rx="2" ry="2"></rect>
                <path d="M5 15H4a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h9a2 2 0 0 1 2 2v1"></path>
            </svg>
            </button>
        </div>
        </div>

        <!-- Hidden link for JS copy/share -->
        <p id="ref-url" style="position:absolute;left:-9999px;">{{ referral_url }}</p>

        <button class="cta" id="share-btn" type="button">Refer Now</button>

        </div>
      </div>
    </div>
  </div>
</section>

<script>
(function(){
  const codeBtn = document.getElementById('copy-code');
  const codeEl  = document.getElementById('ref-code');
  const shareBtn = document.getElementById('share-btn');
  const refUrl = document.getElementById('ref-url')?.textContent.trim();

  async function copy(text){
    try{ await navigator.clipboard.writeText(text); }
    catch(e){
      const ta=document.createElement('textarea'); ta.value=text;
      document.body.appendChild(ta); ta.select(); document.execCommand('copy'); document.body.removeChild(ta);
    }
  }

  codeBtn?.addEventListener('click', async ()=>{
    await copy(codeEl.textContent.trim());
    codeBtn.classList.add('copied');
    setTimeout(()=>codeBtn.classList.remove('copied'), 1200);
  });

  shareBtn?.addEventListener('click', async ()=>{
    if(navigator.share){
      try{ await navigator.share({title:"Join Audio Aura", text:"Use my referral link!", url: refUrl}); }catch(e){}
    }else{
      await copy(refUrl);
      shareBtn.textContent="Link Copied";
      setTimeout(()=> shareBtn.textContent="Refer Now", 1200);
    }
  });
})();
</script>
{% endblock %}
