{% extends "user/base.html" %}
{% load tz %}
{% load static %}
{% block title %}Track Order{% endblock %}

{% block content %}
<style>
  .page {
    padding: 30px 0 54px;
    background: radial-gradient(1200px 700px at 15% -10%, rgba(255, 255, 255, .06), transparent),
                linear-gradient(180deg, #16031f, #2a0830);
  }
  .wrap { max-width: 1240px; margin: 0 auto; padding: 0 16px; color: #fff; }

  .grid { display: grid; grid-template-columns: 360px 1fr; gap: 30px; align-items: start; margin: 0 -86px 0 -98px; }
  @media (max-width: 1100px) { .grid { grid-template-columns: 1fr; } }

  .order-shell {
    background: #fff; color: #111; border-radius: 18px; border: 1px solid #edf0f5;
    box-shadow: 0 10px 30px rgba(0, 0, 0, .18); padding: 22px 22px 37px;
  }
  .order-title { font-size: 26px; font-weight: 700; margin: 36px 0 6px; }
  .order-meta { font-size: 12px; color: #6c7280; margin-bottom: 18px; }
  .order-meta .dot { margin: 0 8px; }

  .order-row { display: grid; grid-template-columns: 0fr 0.6fr 0.4fr 1fr; gap: 40px; align-items: start; margin-top: 55px; }
  @media (max-width: 1000px) { .order-row { grid-template-columns: 1fr; } }

  .prod { display: flex; flex-direction: column; gap: 12px; }
  .prod-card { width: 200px; border-radius: 10px; overflow: hidden; border: 1px solid #eee; background: #fafafa; }
  .prod-card img { display: block; width: 100%; height: auto; }
  .prod-cap { background: #ffc107; color: #111; font-weight: 800; text-align: center; padding: 8px 10px; font-size: 12px; border-top: 1px solid rgba(0, 0, 0, .06); }

  .status-line { font-size: 14px; font-weight: 500; }
  .status-pill { color: #24a148; font-weight: 700; }

  .smalll { display: flex; justify-content: flex-start; }
  .mini-col h5 { font-size: 12px; margin: 0 0 20px; font-weight: 800; color: #111; text-decoration: underline; }
  .mini-col .smalll { font-size: 12px; color: #656d76; line-height: 1.5; }

  .summary {
    background: #fff; border: 1px solid #eee; border-radius: 10px;
    box-shadow: 0 8px 18px rgba(0, 0, 0, 0.08), 0 2px 6px rgba(0, 0, 0, 0.03);
    padding: 14px 16px; margin-top: -14px;
  }
  .summary h5 { font-size: 12px; margin: 0 0 8px; font-weight: 800; text-decoration: underline; text-decoration-color: #827878; }
  .kv { display: flex; justify-content: space-between; align-items: center; font-size: 12px; color: #30363d; padding: 6px 0; }
  .sep { height: 1px; background: #e7e7e7; margin: 6px 0; }
  .kv strong { font-size: 12px; }

  .actions { display: flex; gap: 18px; justify-content: flex-end; margin-top: -36px; }
  .btn-x { height: 38px; padding: 0 18px; border-radius: 6px; border: 1px solid #111; cursor: pointer; font-weight: 800; }
  .btn-cancel { background: #e23b3b; border-color: #e23b3b; color: #fff; font-weight: 500; }
  
  /* ‚úÖ NEW: Return Policy Card */
  .return-policy-card {
    background: linear-gradient(135deg, #fff3cd 0%, #fff8e1 100%);
    border: 2px solid #ffc107;
    border-radius: 12px;
    padding: 18px 20px;
    margin: 24px 0 20px;
    box-shadow: 0 4px 12px rgba(255, 193, 7, 0.25);
  }
  
  .return-timer {
    display: flex;
    align-items: center;
    gap: 10px;
    font-size: 1.15rem;
    font-weight: 700;
    color: #d32f2f;
    margin-bottom: 10px;
  }
  
  .return-timer i {
    animation: pulse 2s infinite;
    font-size: 1.3rem;
  }
  
  @keyframes pulse {
    0%, 100% { transform: scale(1); }
    50% { transform: scale(1.15); }
  }
  
  .countdown-badge {
    background: #d32f2f;
    color: white;
    padding: 6px 16px;
    border-radius: 25px;
    font-size: 0.95rem;
    font-weight: 700;
  }
  
  .return-deadline {
    font-size: 0.95rem;
    color: #555;
    margin: 0;
  }
  
  .return-deadline strong {
    color: #d32f2f;
    font-weight: 700;
  }
  
  /* ‚úÖ Return/Expired Alerts */
  .alert-box {
    padding: 16px 20px;
    border-radius: 10px;
    margin: 20px 0;
    display: flex;
    align-items: center;
    gap: 12px;
    font-size: 14px;
  }
  
  .alert-box i {
    font-size: 1.3rem;
  }
  
  .alert-box.info {
    background: #e3f2fd;
    border: 2px solid #2196f3;
    color: #0d47a1;
  }
  
  .alert-box.secondary {
    background: #f5f5f5;
    border: 2px solid #9e9e9e;
    color: #424242;
  }

  /* OLD HORIZONTAL PROGRESS BAR (Restored) */
  .progress-wrap { margin-top: 60px; }

  .step-labels {
    display: grid; grid-template-columns: repeat(4, 1fr);
    font-size: 13px; color: #6c7280; margin-bottom: 12px; text-align: center;
    gap: 154px;
  }
  .step-labels .done { color: #22c55e; font-weight: 700; }

  .progress-container {
    position: relative; display: flex; justify-content: space-between; align-items: center;
    width: 100%; max-width: 900px; margin: 0 auto;
  }
  .progress-container::before {
    content: ''; position: absolute; top: 50%; left: 0; right: 0; height: 6px;
    background-color: #ccc; border-radius: 10px; transform: translateY(-50%); z-index: 1;
  }
  .progress-line {
    position: absolute; top: 50%; left: 0; height: 6px; background-color: #22c55e;
    border-radius: 10px; transform: translateY(-50%); width: 55%; z-index: 2; transition: width 0.4s ease;
  }
  .step {
    position: relative; z-index: 3; width: 32px; height: 32px; border-radius: 50%;
    background-color: #ccc; display: flex; align-items: center; justify-content: center;
    color: white; font-size: 16px; font-weight: bold;
  }
  .step.active { background-color: #22c55e; }

  .ts-grid{
    display:grid; grid-template-columns:repeat(4,1fr);
    width:100%; max-width:900px; margin:8px auto 0;
  }
  .ts{
    font-size:12px; color:#6c7280; text-align:left; justify-self:start;margin: 0px 0px 0px 38px;
  }

  /* NEW: Detailed Timeline (Below the progress bar) */
  .timeline-details {
    margin-top: 40px;
    padding: 20px;
    background: #fafbfc;
    border-radius: 10px;
    border: 1px solid #e8ebef;
  }

  .timeline-details h4 {
    font-size: 16px;
    font-weight: 700;
    margin: 0 0 20px 0;
    color: #111;
  }

  .detail-item {
    display: flex;
    gap: 15px;
    padding: 12px;
    margin-bottom: 10px;
    background: #fff;
    border-radius: 8px;
    border: 1px solid #e8ebef;
  }

  .detail-icon {
    flex-shrink: 0;
    width: 36px;
    height: 36px;
    border-radius: 50%;
    background: #e0e0e0;
    display: flex;
    align-items: center;
    justify-content: center;
    color: white;
  }

  .detail-item.done .detail-icon {
    background: #4caf50;
  }

  .detail-content {
    flex: 1;
  }

  .detail-label {
    font-size: 14px;
    font-weight: 600;
    color: #9e9e9e;
    margin: 0 0 4px 0;
  }

  .detail-item.done .detail-label {
    color: #4caf50;
  }

  .detail-desc {
    font-size: 12px;
    color: #757575;
    margin: 0 0 4px 0;
  }

  .detail-time {
    font-size: 11px;
    color: #9e9e9e;
  }

  .icon-svg {
    width: 18px;
    height: 18px;
    fill: currentColor;
  }

  .page, .page * {
    font-family: 'Poppins', system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif !important;
    -webkit-font-smoothing: antialiased; -moz-osx-font-smoothing: grayscale;
  }
</style>

<section class="page">
  <div class="wrap">
    <div class="grid">
      {% include "user/sidebar.html" with active_tab="orders" %}

      <div class="order-shell">
        <h2 class="order-title">Track Order</h2>
        <div class="order-meta">
          Ordered on {{ created_ts|date:"d F Y" }} <span class="dot">|</span>
          {% if item.product_name %}<span style="color: #111;font-weight: 700;">{{ item.product_name }}</span>{% endif %}
        </div>
        
        <!-- ‚úÖ NEW: Return Policy Section for DELIVERED items -->
        {% if item.status == 'DELIVERED' %}
          {% if can_return %}
            <!-- Show return countdown -->
            <div class="return-policy-card">
              <div class="return-timer">
                <i class="fas fa-clock"></i>
                <span class="countdown-badge">{{ days_remaining }} day{{ days_remaining|pluralize }}</span>
                left to return
              </div>
              <p class="return-deadline">
                Return by: <strong>{{ return_deadline_formatted }}</strong>
              </p>
            </div>
          {% elif pending_return %}
            <!-- Return request pending -->
            <div class="alert-box info">
              <i class="fas fa-hourglass-half"></i>
              <div>
                <strong>Return Request Pending</strong>
                <p style="margin: 0;">Your return request is being reviewed by our team.</p>
              </div>
            </div>
          {% elif is_return_expired %}
            <!-- Return period expired -->
            <div class="alert-box secondary">
              <i class="fas fa-times-circle"></i>
              <div>
                <strong>Return Period Expired</strong>
                <p style="margin: 0;">{{ return_message }}</p>
              </div>
            </div>
          {% endif %}
        {% endif %}
            
        <div class="order-row">
          <!-- Product -->
          <div class="prod">
            {% for item_card in items %}
            <div class="prod-card">
              <img src="{% if item_card.image_url %}{{ item_card.image_url }}{% else %}{% static 'images/product1.jpg' %}{% endif %}" alt="{{ item_card.product_name }}">
              {% if item_card.badge_label %}<div class="prod-cap">{{ item_card.badge_label }}</div>{% endif %}
            </div>
            {% endfor %}
          </div>

          <!-- Shipping + Status -->
          <div class="mini-col">
            <h5>Shipping Address</h5>
            <div class="smalll">
              {% for line in ship_lines %}{{ line }}{% if not forloop.last %}<br>{% endif %}{% endfor %}
            </div>
            <div style="height:90px"></div>
            <div class="status-line">Status : <span class="status-pill">{{ item.get_status_display }}</span></div>
          </div>

          <!-- Payment -->
          <div class="mini-col">
            <h5>Payment Method</h5>
            <div class="smalll">
              {% if order.get_payment_method_display %}
                {{ order.get_payment_method_display }}
              {% else %}
                {{ payment_method|default:"Cash On Delivery" }}
              {% endif %}
            </div>
          </div>

          <!-- Summary -->
          <div class="summary">
            <h5>Order Summary</h5>
            <div class="kv"><span>Items Total</span><span>: ‚Çπ{{ items_total|floatformat:0 }}</span></div>
            <div class="kv"><span>Shipping Charge</span><span>: ‚Çπ{{ shipping_charge|floatformat:0 }}</span></div>
            {% if discount %}
              <div class="kv"><span>Discount</span><span>: -‚Çπ{{ discount|floatformat:0 }}</span></div>
            {% endif %}
            <div class="sep"></div>
            <div class="kv"><strong>Grand Total</strong><strong>: ‚Çπ{{ grand_total|floatformat:0 }}</strong></div>
          </div>
        </div>

        <!-- ‚úÖ Actions - Updated with 10-day policy -->
        <div class="actions">
          {% if item.status == "DELIVERED" %}
            <!-- ‚úÖ Show return button only if eligible -->
            {% if can_return %}
              <button class="btn-x btn-cancel" type="button" id="returnToggleBtn" style="background: #ff9800; border-color: #ff9800;">
                <i class="fas fa-undo"></i> Request Return
              </button>
            {% elif pending_return %}
              <button class="btn-x" disabled style="background: #ccc; border-color: #ccc; cursor: not-allowed;">
                Return Pending
              </button>
            {% endif %}

          {% elif item.status not in 'CANCELLED,RETURNED' %}
            {% if pending_cancel %}
              <button class="btn-x" disabled style="background: #ccc; border-color: #ccc; cursor: not-allowed;">
                Cancel Pending
              </button>
            {% else %}
              <form method="post" action="{% url 'request_cancel_item' order.order_number item.id %}" style="display:inline;">
                {% csrf_token %}
                <button class="btn-x btn-cancel" type="submit">Request Cancel</button>
              </form>
            {% endif %}
          {% endif %}
        </div>

        <!-- ‚úÖ Return Form - Only show if can_return is True -->
        {% if item.status == "DELIVERED" and can_return %}
          <div id="trkReturnFormWrap" class="mt-3" style="display:none; margin-top:20px; padding:20px; background:#f8f9fa; border-radius:8px;">
            <form method="post" action="{% url 'request_return_item' order.order_number item.id %}">
              {% csrf_token %}
              <div style="background: #fff3cd; border: 1px solid #ffc107; padding: 12px; border-radius: 6px; margin-bottom: 15px; font-size: 12px; color: #856404;">
                <strong>‚ö†Ô∏è Return Policy:</strong> Items must be returned within <strong>{{ return_window_days }} days</strong> of delivery
              </div>
              
              <label for="trk-ret-reason" style="font-weight:600; font-size:13px; color:#111;">Reason for return *</label>
              <select id="trk-ret-reason" name="reason" class="form-control" required
                      style="margin-top:6px; font-size:13px; width:100%; padding:10px; border:1px solid #ddd; border-radius:4px;">
                <option value="">-- Select a reason --</option>
                <option value="Defective product">Defective or damaged product</option>
                <option value="Wrong item received">Wrong item received</option>
                <option value="Not as described">Product not as described</option>
                <option value="Quality issues">Quality issues</option>
                <option value="Size/fit issues">Size or fit issues</option>
                <option value="Changed my mind">Changed my mind</option>
                <option value="Other">Other reason</option>
              </select>
              
              <label for="trk-ret-note" style="font-weight:600; font-size:13px; color:#111; margin-top:12px; display:block;">Additional details (optional)</label>
              <textarea id="trk-ret-note" name="note" class="form-control" maxlength="500"
                        style="margin-top:6px; font-size:13px; width:100%; padding:10px; border:1px solid #ddd; border-radius:4px;" rows="3"
                        placeholder="Provide more details..."></textarea>
              
              <div style="margin-top:10px; display:flex; gap:10px;">
                <button type="submit" class="btn-x btn-cancel" style="background:#ff9800; border-color:#ff9800;">
                  <i class="fas fa-paper-plane"></i> Submit Return Request
                </button>
                <button type="button" class="btn-x" id="trkReturnCancelBtn" style="background:#f1f1f1;">Close</button>
              </div>
            </form>
          </div>
          <script>
            (function(){
              const toggle = document.getElementById('returnToggleBtn');
              const wrap = document.getElementById('trkReturnFormWrap');
              const closeBtn = document.getElementById('trkReturnCancelBtn');
              const reasonSelect = document.getElementById('trk-ret-reason');
              const submitBtn = wrap ? wrap.querySelector('button[type="submit"]') : null;
              
              if(toggle && wrap){
                toggle.addEventListener('click', function(){ 
                  wrap.style.display = (wrap.style.display === 'none' || !wrap.style.display) ? 'block' : 'none'; 
                });
              }
              if(closeBtn && wrap){
                closeBtn.addEventListener('click', function(){ wrap.style.display = 'none'; });
              }
              
              // Form validation
              if(wrap && submitBtn && reasonSelect){
                wrap.querySelector('form').addEventListener('submit', function(e){
                  if(!reasonSelect.value){
                    e.preventDefault();
                    alert('Please select a return reason');
                    return false;
                  }
                });
              }
            })();
          </script>
        {% endif %}

        <!-- OLD HORIZONTAL PROGRESS BAR (Restored) -->
        <div class="progress-wrap">
          <div class="step-labels">
            <div class="{% if progress.step >= 1 %}done{% endif %}">Order Confirmed</div>
            <div class="{% if progress.step >= 2 %}done{% endif %}">Shipped</div>
            <div class="{% if progress.step >= 3 %}done{% endif %}">Out for Delivery</div>
            <div class="{% if progress.step >= 4 %}done{% endif %}">Delivered</div>
          </div>

          <div class="progress-container">
            <div class="progress-line" style="width: {{ progress.width }};"></div>
            <div class="step {% if progress.step >= 1 %}active{% endif %}">
              <i>
                <svg xmlns="http://www.w3.org/2000/svg" width="17" height="17" viewBox="0 0 512 512" fill="white">
                  <path d="M 19.2 51.2 Q 1.6 52.8 0 70.4 Q 1.6 88 19.2 89.6 L 56 89.6 L 56 89.6 Q 60.8 89.6 61.6 95.2 L 103.2 312 L 103.2 312 Q 107.2 332 123.2 345.6 Q 138.4 358.4 160 358.4 L 256.8 358.4 L 256.8 358.4 Q 256 352 256 345.6 Q 256 332.8 258.4 320 L 160 320 L 160 320 Q 144.8 319.2 140.8 304.8 L 136.8 281.6 L 136.8 281.6 L 271.2 281.6 L 271.2 281.6 Q 282.4 260 300 243.2 L 129.6 243.2 L 129.6 243.2 L 104.8 115.2 L 104.8 115.2 L 416.8 115.2 L 416.8 115.2 L 392.8 204.8 L 392.8 204.8 Q 394.4 204.8 396.8 204.8 Q 414.4 204.8 431.2 208.8 L 456 116.8 L 456 116.8 Q 459.2 101.6 450.4 89.6 Q 440.8 77.6 424.8 76.8 L 96 76.8 L 96 76.8 Q 84 52.8 56 51.2 L 19.2 51.2 L 19.2 51.2 Z M 140.8 460.8 Q 162.4 460 174.4 441.6 Q 184 422.4 174.4 403.2 Q 162.4 384.8 140.8 384 Q 119.2 384.8 107.2 403.2 Q 97.6 422.4 107.2 441.6 Q 119.2 460 140.8 460.8 L 140.8 460.8 Z M 512 345.6 Q 512 314.4 496.8 288 L 496.8 288 L 496.8 288 Q 481.6 261.6 454.4 245.6 Q 427.2 230.4 396.8 230.4 Q 366.4 230.4 339.2 245.6 Q 312 261.6 296.8 288 Q 281.6 314.4 281.6 345.6 Q 281.6 376.8 296.8 403.2 Q 312 429.6 339.2 445.6 Q 366.4 460.8 396.8 460.8 Q 427.2 460.8 454.4 445.6 Q 481.6 429.6 496.8 403.2 Q 512 376.8 512 345.6 L 512 345.6 Z M 432.8 311.2 Q 441.6 303.2 450.4 311.2 Q 458.4 320 450.4 328.8 L 392.8 386.4 L 392.8 386.4 Q 384 394.4 375.2 386.4 L 343.2 354.4 L 343.2 354.4 Q 335.2 345.6 343.2 336.8 Q 352 328.8 360.8 336.8 L 384 359.2 L 384 359.2 L 432.8 311.2 L 432.8 311.2 Z" />
                </svg>
              </i>
            </div>
            <div class="step {% if progress.step >= 2 %}active{% endif %}">
              <i>
              <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 640 512" fill="white">
                <path d="M64 96c0-35.3 28.7-64 64-64l288 0c35.3 0 64 28.7 64 64l0 32 50.7 0c17 0 33.3 6.7 45.3 18.7L621.3 192c12 12 18.7 28.3 18.7 45.3L640 384c0 35.3-28.7 64-64 64l-3.3 0c-10.4 36.9-44.4 64-84.7 64s-74.2-27.1-84.7-64l-102.6 0c-10.4 36.9-44.4 64-84.7 64s-74.2-27.1-84.7-64l-3.3 0c-35.3 0-64-28.7-64-64l0-48-40 0c-13.3 0-24-10.7-24-24s10.7-24 24-24l112 0c13.3 0 24-10.7 24-24s-10.7-24-24-24L24 240c-13.3 0-24-10.7-24-24s10.7-24 24-24l176 0c13.3 0 24-10.7 24-24s-10.7-24-24-24L24 144c-13.3 0-24-10.7-24-24S10.7 96 24 96l40 0zM576 288l0-50.7-45.3-45.3-50.7 0 0 96 96 0zM256 424a40 40 0 1 0 -80 0 40 40 0 1 0 80 0zm232 40a40 40 0 1 0 0-80 40 40 0 1 0 0 80z"/>
              </svg>
              </i>
            </div>
            <div class="step {% if progress.step >= 3 %}active{% endif %}">
              <i>
                <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-box-seam" viewBox="0 0 16 16">
                  <path d="M8.186 1.113a.5.5 0 0 0-.372 0L1.846 3.5l2.404.961L10.404 2zm3.564 1.426L5.596 5 8 5.961 14.154 3.5zm3.25 1.7-6.5 2.6v7.922l6.5-2.6V4.24zM7.5 14.762V6.838L1 4.239v7.923zM7.443.184a1.5 1.5 0 0 1 1.114 0l7.129 2.852A.5.5 0 0 1 16 3.5v8.662a1 1 0 0 1-.629.928l-7.185 2.874a.5.5 0 0 1-.372 0L.63 13.09a1 1 0 0 1-.63-.928V3.5a.5.5 0 0 1 .314-.464z"/>
                </svg>
              </i>
            </div>
            <div class="step {% if progress.step >= 4 %}active{% endif %}">
              <i>
                <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-house-check" viewBox="0 0 16 16">
                  <path d="M7.293 1.5a1 1 0 0 1 1.414 0L11 3.793V2.5a.5.5 0 0 1 .5-.5h1a.5.5 0 0 1 .5.5v3.293l2.354 2.353a.5.5 0 0 1-.708.708L8 2.207l-5 5V13.5a.5.5 0 0 0 .5.5h4a.5.5 0 0 1 0 1h-4A1.5 1.5 0 0 1 2 13.5V8.207l-.646.647a.5.5 0 1 1-.708-.708z"/>
                  <path d="M12.5 16a3.5 3.5 0 1 0 0-7 3.5 3.5 0 0 0 0 7m1.679-4.493-1.335 2.226a.75.75 0 0 1-1.174.144l-.774-.773a.5.5 0 0 1 .708-.707l.547.547 1.17-1.951a.5.5 0 1 1 .858.514"/>
                </svg>
              </i>
            </div>
          </div>

          <div class="ts-grid">
            <div class="ts">{{ created_ts|date:"d F Y" }}</div>
            <div class="ts">{% if shipped_ts %}{{ shipped_ts|date:"d F Y" }}{% endif %}</div>
            <div class="ts">{% if ofd_ts %}{{ ofd_ts|date:"d F Y" }}{% endif %}</div>
            <div class="ts">{% if delivered_ts %}{{ delivered_ts|date:"d F Y" }}{% endif %}</div>
          </div>
        </div>

        <!-- NEW: Detailed Timeline (Compact horizontal cards below bar) -->
        {% if timeline_steps %}
        <div class="timeline-details">
          <h4>üì¶ Detailed Tracking Information</h4>
          {% for step in timeline_steps %}
          <div class="detail-item {% if step.done %}done{% endif %}">
            <div class="detail-icon">
              {% if step.icon == "cart" %}
                <svg xmlns="http://www.w3.org/2000/svg" width="17" height="17" viewBox="0 0 512 512" fill="white">
                  <path d="M 19.2 51.2 Q 1.6 52.8 0 70.4 Q 1.6 88 19.2 89.6 L 56 89.6 L 56 89.6 Q 60.8 89.6 61.6 95.2 L 103.2 312 L 103.2 312 Q 107.2 332 123.2 345.6 Q 138.4 358.4 160 358.4 L 256.8 358.4 L 256.8 358.4 Q 256 352 256 345.6 Q 256 332.8 258.4 320 L 160 320 L 160 320 Q 144.8 319.2 140.8 304.8 L 136.8 281.6 L 136.8 281.6 L 271.2 281.6 L 271.2 281.6 Q 282.4 260 300 243.2 L 129.6 243.2 L 129.6 243.2 L 104.8 115.2 L 104.8 115.2 L 416.8 115.2 L 416.8 115.2 L 392.8 204.8 L 392.8 204.8 Q 394.4 204.8 396.8 204.8 Q 414.4 204.8 431.2 208.8 L 456 116.8 L 456 116.8 Q 459.2 101.6 450.4 89.6 Q 440.8 77.6 424.8 76.8 L 96 76.8 L 96 76.8 Q 84 52.8 56 51.2 L 19.2 51.2 L 19.2 51.2 Z M 140.8 460.8 Q 162.4 460 174.4 441.6 Q 184 422.4 174.4 403.2 Q 162.4 384.8 140.8 384 Q 119.2 384.8 107.2 403.2 Q 97.6 422.4 107.2 441.6 Q 119.2 460 140.8 460.8 L 140.8 460.8 Z M 512 345.6 Q 512 314.4 496.8 288 L 496.8 288 L 496.8 288 Q 481.6 261.6 454.4 245.6 Q 427.2 230.4 396.8 230.4 Q 366.4 230.4 339.2 245.6 Q 312 261.6 296.8 288 Q 281.6 314.4 281.6 345.6 Q 281.6 376.8 296.8 403.2 Q 312 429.6 339.2 445.6 Q 366.4 460.8 396.8 460.8 Q 427.2 460.8 454.4 445.6 Q 481.6 429.6 496.8 403.2 Q 512 376.8 512 345.6 L 512 345.6 Z M 432.8 311.2 Q 441.6 303.2 450.4 311.2 Q 458.4 320 450.4 328.8 L 392.8 386.4 L 392.8 386.4 Q 384 394.4 375.2 386.4 L 343.2 354.4 L 343.2 354.4 Q 335.2 345.6 343.2 336.8 Q 352 328.8 360.8 336.8 L 384 359.2 L 384 359.2 L 432.8 311.2 L 432.8 311.2 Z" />
                </svg>
              {% elif step.icon == "hourglass" %}
                <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-hourglass-split" viewBox="0 0 16 16">
                  <path d="M2.5 15a.5.5 0 1 1 0-1h1v-1a4.5 4.5 0 0 1 2.557-4.06c.29-.139.443-.377.443-.59v-.7c0-.213-.154-.451-.443-.59A4.5 4.5 0 0 1 3.5 3V2h-1a.5.5 0 0 1 0-1h11a.5.5 0 0 1 0 1h-1v1a4.5 4.5 0 0 1-2.557 4.06c-.29.139-.443.377-.443.59v.7c0 .213.154.451.443.59A4.5 4.5 0 0 1 12.5 13v1h1a.5.5 0 0 1 0 1zm2-13v1c0 .537.12 1.045.337 1.5h6.326c.216-.455.337-.963.337-1.5V2zm3 6.35c0 .701-.478 1.236-1.011 1.492A3.5 3.5 0 0 0 4.5 13s.866-1.299 3-1.48zm1 0v3.17c2.134.181 3 1.48 3 1.48a3.5 3.5 0 0 0-1.989-3.158C8.978 9.586 8.5 9.052 8.5 8.351z"/>
                </svg>
              {% elif step.icon == "box" %}
                <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-box-seam" viewBox="0 0 16 16">
                  <path d="M8.186 1.113a.5.5 0 0 0-.372 0L1.846 3.5l2.404.961L10.404 2zm3.564 1.426L5.596 5 8 5.961 14.154 3.5zm3.25 1.7-6.5 2.6v7.922l6.5-2.6V4.24zM7.5 14.762V6.838L1 4.239v7.923zM7.443.184a1.5 1.5 0 0 1 1.114 0l7.129 2.852A.5.5 0 0 1 16 3.5v8.662a1 1 0 0 1-.629.928l-7.185 2.874a.5.5 0 0 1-.372 0L.63 13.09a1 1 0 0 1-.63-.928V3.5a.5.5 0 0 1 .314-.464z"/>
                </svg>
              {% elif step.icon == "truck" %}
              <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 640 512" fill="white">
                <path d="M64 96c0-35.3 28.7-64 64-64l288 0c35.3 0 64 28.7 64 64l0 32 50.7 0c17 0 33.3 6.7 45.3 18.7L621.3 192c12 12 18.7 28.3 18.7 45.3L640 384c0 35.3-28.7 64-64 64l-3.3 0c-10.4 36.9-44.4 64-84.7 64s-74.2-27.1-84.7-64l-102.6 0c-10.4 36.9-44.4 64-84.7 64s-74.2-27.1-84.7-64l-3.3 0c-35.3 0-64-28.7-64-64l0-48-40 0c-13.3 0-24-10.7-24-24s10.7-24 24-24l112 0c13.3 0 24-10.7 24-24s-10.7-24-24-24L24 240c-13.3 0-24-10.7-24-24s10.7-24 24-24l176 0c13.3 0 24-10.7 24-24s-10.7-24-24-24L24 144c-13.3 0-24-10.7-24-24S10.7 96 24 96l40 0zM576 288l0-50.7-45.3-45.3-50.7 0 0 96 96 0zM256 424a40 40 0 1 0 -80 0 40 40 0 1 0 80 0zm232 40a40 40 0 1 0 0-80 40 40 0 1 0 0 80z"/>
              </svg>
              {% elif step.icon == "check-circle" %}
                <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-house-check" viewBox="0 0 16 16">
                  <path d="M7.293 1.5a1 1 0 0 1 1.414 0L11 3.793V2.5a.5.5 0 0 1 .5-.5h1a.5.5 0 0 1 .5.5v3.293l2.354 2.353a.5.5 0 0 1-.708.708L8 2.207l-5 5V13.5a.5.5 0 0 0 .5.5h4a.5.5 0 0 1 0 1h-4A1.5 1.5 0 0 1 2 13.5V8.207l-.646.647a.5.5 0 1 1-.708-.708z"/>
                  <path d="M12.5 16a3.5 3.5 0 1 0 0-7 3.5 3.5 0 0 0 0 7m1.679-4.493-1.335 2.226a.75.75 0 0 1-1.174.144l-.774-.773a.5.5 0 0 1 .708-.707l.547.547 1.17-1.951a.5.5 0 1 1 .858.514"/>
                </svg>
              {% endif %}
            </div>
            <div class="detail-content">
              <div class="detail-label">{{ step.label }}</div>
              <div class="detail-desc">{{ step.description }}</div>
              {% if step.timestamp %}
                <div class="detail-time">{{ step.timestamp|timezone:"Asia/Kolkata"|date:"d/m/Y, h:i A" }}</div>
              {% endif %}
            </div>
          </div>
          {% endfor %}
        </div>
        {% endif %}

      </div>
    </div>
  </div>
</section>
{% endblock %}
