{% extends 'user/base.html' %}
{% load static %}
{% load static deal_tags %}
{% block title %}
Audio Aura
{% endblock %}

{% block content %}

<!-- Dynamic Carousel -->
{% if banners %}
<div id="carouselExampleCaptions" class="carousel slide" data-bs-ride="carousel" data-bs-interval="10000" data-bs-wrap="true">
  <!-- Dynamic Indicators -->
  <div class="carousel-indicators">
    {% for banner in banners %}
    <button type="button" 
            data-bs-target="#carouselExampleCaptions" 
            data-bs-slide-to="{{ forloop.counter0 }}" 
            class="{% if forloop.first %}active{% endif %}" 
            aria-current="{% if forloop.first %}true{% endif %}" 
            aria-label="Slide {{ forloop.counter }}">
    </button>
    {% endfor %}
  </div>

  <!-- Dynamic Slides -->
  <div class="carousel-inner">
    {% for banner in banners %}
    <div class="carousel-item {% if forloop.first %}active{% endif %}">
      {% if banner.link_url %}
        <a href="{{ banner.link_url }}">
      {% endif %}
      
      {% if banner.media_type == 'video' and banner.video %}
        <!-- Video Banner -->
        <video class="ban d-block w-100" autoplay muted loop playsinline>
          <source src="{{ banner.video.url }}" type="video/mp4">
          Your browser does not support the video tag.
        </video>
      {% elif banner.image %}
        <!-- Image Banner -->
        <img src="{{ banner.image.url }}" class="d-block w-100" alt="{{ banner.title }}">
      {% else %}
        <!-- Fallback if no media -->
        <img src="{% static 'images/placeholder-banner.jpg' %}" class="d-block w-100" alt="Banner">
      {% endif %}
      
      {% if banner.link_url %}
        </a>
      {% endif %}
      
      <!-- Optional: Show banner title/description as caption -->
      {% if banner.description %}
      <div class="carousel-caption d-none d-md-block">
        <h5>{{ banner.title }}</h5>
        <p></p>
      </div>
      {% endif %}
    </div>
    {% endfor %}
  </div>

  <!-- Carousel Controls -->
  <button class="carousel-control-prev" type="button" data-bs-target="#carouselExampleCaptions" data-bs-slide="prev">
    <span class="carousel-control-prev-icon" aria-hidden="true"></span>
    <span class="visually-hidden">Previous</span>
  </button>
  <button class="carousel-control-next" type="button" data-bs-target="#carouselExampleCaptions" data-bs-slide="next">
    <span class="carousel-control-next-icon" aria-hidden="true"></span>
    <span class="visually-hidden">Next</span>
  </button>
</div>
{% else %}
<!-- Fallback: Show default static carousel if no banners in database -->
<div id="carouselExampleCaptions" class="carousel slide" data-bs-ride="carousel" data-bs-interval="5000" data-bs-wrap="true">
  <div class="carousel-indicators">
    <button type="button" data-bs-target="#carouselExampleCaptions" data-bs-slide-to="0" class="active" aria-current="true" aria-label="Slide 1"></button>
    <button type="button" data-bs-target="#carouselExampleCaptions" data-bs-slide-to="1" aria-label="Slide 2"></button>
    <button type="button" data-bs-target="#carouselExampleCaptions" data-bs-slide-to="2" aria-label="Slide 3"></button>
  </div>
  <div class="carousel-inner">
    <div class="carousel-item active">
      <img src="{% static 'images/img1_carou.jpg' %}" class="d-block w-100" alt="Default Banner 1">
    </div>
    <div class="carousel-item">
      <img src="{% static 'images/img2_carou.jpg' %}" class="d-block w-100" alt="Default Banner 2">
    </div>
    <div class="carousel-item">
      <img src="{% static 'images/img3_carou.webp' %}" class="d-block w-100" alt="Default Banner 3">
    </div>
  </div>
</div>
{% endif %}


<style>

.brandd-logo {
    max-height: 72px;
    width: auto;
    display: block;
    transition: transform 0.25s ease, filter 0.25s ease;
    filter: brightness(1);
}
.featured-section {
    padding: 0;
    background: #f0f0f0;
    min-height: 400px;
    overflow: hidden;
}
.featured-left {
    flex: 1.2;
    background: linear-gradient(180deg, #2d1b69, #000000 100%);
    display: flex;
    align-items: center;
    justify-content: center;
    padding: 0px;
    position: relative;
    overflow: hidden;
}
.featured-container {
    max-width: 100%;
    margin: -1px;
    display: flex;
    align-items: stretch;
    height: 400px;
    position: relative;
}

/* ========== MOBILE & TABLET RESPONSIVE STYLES ========== */

/* Mobile & Tablet (up to 991px) */
@media (max-width: 991px) {
  /* Carousel adjustments */
  .carousel-inner img {
    height: 300px;
    object-fit: cover;
  }
  
  /* Brand strip - keep in single row, smaller logos */
  .brand-strip .brands {
    gap: 15px;
    padding: 20px 10px;
    justify-content: space-evenly !important;
  }
  
  .brand-logo {
    max-height: 45px;
  }
  
  /* Deal section - stack vertically, show 1 image */
  .deal-section .container {
    flex-direction: column !important;
    padding: 30px 15px !important;
  }
  
  .deal-content {
    width: 100% !important;
    text-align: center;
    margin-bottom: 30px;
  }
  
  .deal-content h1 {
    font-size: 32px !important;
  }
  
  .deal-content p {
    font-size: 14px !important;
    line-height: 1.5;
  }
  
  .countdown {
    justify-content: center !important;
    gap: 10px !important;
    flex-wrap: wrap;
  }
  
  .countdown > div {
    padding: 12px 16px !important;
    font-size: 14px !important;
  }
  
  .countdown span {
    font-size: 24px !important;
  }
  
  /* Deal carousel - show only ONE image */
  .deal-carousel {
    width: 100% !important;
    max-width: 100% !important;
  }
  
  .deal-products {
    justify-content: center !important;
  }
  
  .deal-products img:last-child {
    display: none !important;
  }
  
  .deal-products img {
    max-width: 300px !important;
    width: 100% !important;
    height: auto !important;
  }
  
  /* New Arrivals Section */
  .section-header h2 {
    font-size: 32px !important;
  }
  
  .section-description {
    font-size: 14px !important;
    padding: 0 15px;
  }
  
  /* Category tabs - scroll horizontally */
  .category-tabs {
    overflow-x: auto;
    white-space: nowrap;
    -webkit-overflow-scrolling: touch;
    padding-bottom: 10px;
    margin-bottom: 20px;
  }
  
  .tab-btn {
    font-size: 13px !important;
    padding: 8px 14px !important;
  }
  
  /* Products grid - 3 columns on mobile & tablet */
  .aa-grid {
    grid-template-columns: repeat(3, 1fr) !important;
    gap: 15px !important;
  }
  
  .aa-card.aa-232 {
    width: 100% !important;
  }
  
  .aa-232 .aa-media {
    width: 100% !important;
    height: auto !important;
    aspect-ratio: 1 / 1;
  }
  
  .aa-232 .aa-img {
    width: 100% !important;
    height: 100% !important;
  }
  
  .aa-232 .aa-info {
    width: 100% !important;
    height: auto !important;
    padding: 30px 8px 10px !important;
  }
  
  .aa-title {
    font-size: 13px !important;
    line-height: 1.2 !important;
  }
  
  .aa-price {
    font-size: 15px !important;
  }
  
  .aa-badge {
    font-size: 9px !important;
    padding: 2px 6px !important;
  }
  
  .aa-band-text {
    font-size: 10px !important;
  }
  
  .aa-chip {
    font-size: 10px !important;
    padding: 3px 6px !important;
  }
  
  /* Featured section - stack vertically */
  .featured-container {
    flex-direction: column !important;
    height: auto !important;
  }
  
  .featured-left,
  .featured-right {
    width: 100% !important;
    flex: none !important;
  }
  
  .featured-left {
    min-height: 300px;
  }
  
  .featured-right {
    padding: 30px 20px !important;
  }
  
  .featured-title {
    font-size: 28px !important;
  }
  
  .featured-description {
    font-size: 14px !important;
  }
  
  .featured-price {
    font-size: 32px !important;
  }
  
  /* Features band - KEEP IN SINGLE ROW (4 columns) */
  .features_band {
    display: grid !important;
    grid-template-columns: repeat(4, 1fr) !important;
    gap: 10px !important;
    padding: 30px 10px !important;
  }
  
  .features_item {
    padding: 15px 5px !important;
    text-align: center;
  }
  
  .features_item img {
    max-width: 35px !important;
    height: auto;
    margin: 0 auto 8px;
  }
  
  .features_title {
    font-size: 11px !important;
    margin: 5px 0 !important;
    line-height: 1.2;
  }
  
  .features_text {
    font-size: 10px !important;
    margin: 0;
  }
}

/* Extra small mobile adjustments */
@media (max-width: 480px) {
  .carousel-inner img {
    height: 250px;
  }
  
  .brand-logo {
    max-height: 38px;
  }
  
  .deal-content h1 {
    font-size: 26px !important;
  }
  
  .countdown > div {
    padding: 10px 12px !important;
  }
  
  .countdown span {
    font-size: 20px !important;
  }
  
  .section-header h2 {
    font-size: 26px !important;
  }
  
  .aa-grid {
    gap: 10px !important;
  }
  
  .aa-title {
    font-size: 11px !important;
  }
  
  .aa-price {
    font-size: 13px !important;
  }
  
  .features_item img {
    max-width: 30px !important;
  }
  
  .features_title {
    font-size: 10px !important;
  }
  
  .features_text {
    font-size: 9px !important;
  }
}

/* Desktop - 992px and above - keep original styles */
@media (min-width: 992px) {
  /* Products grid - 4 columns on desktop */
  .aa-grid {
    grid-template-columns: repeat(4, 1fr) !important;
  }
}

/* Smooth scrolling for category tabs */
.category-tabs::-webkit-scrollbar {
  height: 4px;
}

.category-tabs::-webkit-scrollbar-track {
  background: #f1f1f1;
}

.category-tabs::-webkit-scrollbar-thumb {
  background: #888;
  border-radius: 4px;
}

.category-tabs::-webkit-scrollbar-thumb:hover {
  background: #555;
}

</style>

<!-- Brand strip -->
<div class="container-fluid my-5">
  <div class="brand-strip">
    <div class="brands d-flex align-items-center justify-content-around flex-wrap">
      <a href="{% url 'shop' %}?brand=1" class="brand-link" aria-label="boAt products">
        <img src="https://res.cloudinary.com/dxndvadjt/image/upload/v1765253600/boat-logo-editorial-free-vector_oohlxm.jpg" alt="boAt" class="brand-logo">
      </a>

      <a href="{% url 'shop' %}?brand=2" class="brand-link" aria-label="JBL products">
        <img src="https://res.cloudinary.com/dxndvadjt/image/upload/v1765253617/JBL_htfgay.png" alt="JBL" class="brand-logo">
      </a>

      <a href="{% url 'shop' %}?brand=3" class="brand-link" aria-label="Sony products">
        <img src="https://res.cloudinary.com/dxndvadjt/image/upload/v1765253632/Sony_lh6sai.jpg" alt="Sony" class="brand-logo">
      </a>

      <a href="{% url 'shop' %}?brand=4" class="brand-link" aria-label="Marshall products">
        <img src="https://res.cloudinary.com/dxndvadjt/image/upload/v1765253648/Marshall_durout.png" alt="Marshall" class="brand-logo">
      </a>
    </div>
  </div>
</div>

{% if active_deal %}
<section class="deal-section">
  <div class="container d-flex align-items-center justify-content-between flex-wrap">
    
    <!-- Left Content (Dynamic) -->
    <div class="deal-content">
      <h1>{{ active_deal.title }}</h1>
      <p>{{ active_deal.description|linebreaks }}</p>

      <a style="text-decoration: none;" href="{{ active_deal.cta_url }}">
        <button class="buy-btn">{{ active_deal.cta_text }}</button>
      </a>
      
      <h4 class="deal-subtitle">Hurry, Before It's Too Late!</h4>
      <div class="countdown">
        <div><span id="days">00</span><br>Days</div>
        <div><span id="hours">00</span><br>Hr</div>
        <div><span id="minutes">00</span><br>Mins</div>
        <div><span id="seconds">00</span><br>Sec</div>
      </div>
    </div>

    <!-- Right Carousel (Dynamic) -->
    <div class="deal-carousel">
      <div id="productCarousel" class="carousel slide" data-bs-ride="carousel">
        <div class="carousel-inner">
          {% with image_pairs=active_deal.images.all|chunk_images:2 %}
            {% for pair in image_pairs %}
              <div class="carousel-item {% if forloop.first %}active{% endif %}">
                <div class="deal-products d-flex">
                  {% for img in pair %}
                    <img src="{{ img.image.url }}" alt="{{ active_deal.title }}">
                  {% endfor %}
                </div>
              </div>
            {% empty %}
              <div class="carousel-item active">
                <div class="deal-products d-flex justify-content-center">
                  <div class="text-center text-white">
                    <p>No images available</p>
                  </div>
                </div>
              </div>
            {% endfor %}
          {% endwith %}
        </div>

        <!-- Dots (Dynamic) -->
        {% with image_pairs=active_deal.images.all|chunk_images:2 %}
          {% if image_pairs|length > 1 %}
            <div class="carousel-indicators position-static mt-4">
              {% for pair in image_pairs %}
                <button type="button" data-bs-target="#productCarousel" 
                        data-bs-slide-to="{{ forloop.counter0 }}" 
                        {% if forloop.first %}class="active"{% endif %}></button>
              {% endfor %}
            </div>
          {% endif %}
        {% endwith %}
      </div>
    </div>
  </div>
</section>

<!-- Countdown Timer Script -->
<script>
document.addEventListener('DOMContentLoaded', function() {
    {% if active_deal %}
    const endDate = new Date("{{ active_deal.ends_on|date:'c' }}").getTime();
    
    function updateCountdown() {
        const now = new Date().getTime();
        const distance = endDate - now;
        
        if (distance < 0) {
            document.querySelector('.countdown').innerHTML = '<h3 style="color: #ff4444;">Deal Expired!</h3>';
            clearInterval(countdownInterval);
            return;
        }
        
        const days = Math.floor(distance / (1000 * 60 * 60 * 24));
        const hours = Math.floor((distance % (1000 * 60 * 60 * 24)) / (1000 * 60 * 60));
        const minutes = Math.floor((distance % (1000 * 60 * 60)) / (1000 * 60));
        const seconds = Math.floor((distance % (1000 * 60)) / 1000);
        
        document.getElementById('days').textContent = String(days).padStart(2, '0');
        document.getElementById('hours').textContent = String(hours).padStart(2, '0');
        document.getElementById('minutes').textContent = String(minutes).padStart(2, '0');
        document.getElementById('seconds').textContent = String(seconds).padStart(2, '0');
    }
    
    updateCountdown();
    const countdownInterval = setInterval(updateCountdown, 1000);
    {% endif %}
});
</script>
{% endif %}

  <!-- New Arrivals Section -->
  <section class="new-arrivals" id="new_arrival">
    <div class="container">
      <div class="section-header">
        <h2 class="section-title">New Arrivals</h2>
        <p class="section-description">
          Discover the latest arrivals in premium speakers ‚Äì from portable bluetooth speakers to powerful party sound systems.
        </p>
      </div>

  <div class="category-tabs">
    <button class="tab-btn active" data-category="">New Launch</button>
    {% for c in categories %}
      <button class="tab-btn" data-category="{{ c.name }}">{{ c.name }}</button>
    {% endfor %}
  </div>

        <div class="products-grid aa-grid">
          {% for p in latest_products %}
            <div class="aa-card aa-232 aa-elev">
              <a class="aa-media" href="{% url 'product_detail' p.id %}">
                
                  <span class="aa-badge">
                    <span class="aa-badge-emoji">üéâ</span>
                    <span class="aa-badge-text">New Launch</span>
                  </span>
                

                {% if p.images.all %}
                  <img class="aa-img" src="{{ p.images.first.image.url }}" alt="{{ p.name }}">
                {% elif p.image %}
                  <img class="aa-img" src="{{ p.image.url }}" alt="{{ p.name }}">
                {% else %}
                  <img class="aa-img" src="{% static 'images/default-product.png' %}" alt="{{ p.name }}">
                {% endif %}

                <div class="aa-band">
                  <span class="aa-band-text">{{ p.offer }}</span>
                  <span class="aa-chip"><span>‚≠ê{{ p.rating|default:4.7 }}</span></span>
                </div>
              </a>

              <div class="aa-info">
                <h3 class="aa-title">
                  <a href="{% url 'product_detail' p.id %}" class="text-decoration-none text-reset" >{{ p.name }}</a>
                </h3>

                <div class="aa-divider"></div>

                <div class="aa-price-row">
                  <div class="aa-price-group">
                    <div class="aa-price">‚Çπ{{ p.final_price|floatformat:0 }}</div>
                    {% if p.discount_percent > 0 %}
                      <div class="aa-sub">
                        <span class="aa-mrp">‚Çπ{{ p.base_price }}</span>
                        <span class="aa-off">{{ p.discount_percent }}% off</span>
                      </div>
                    {% endif %}
                  </div>

                  {# Variants swatches (show up to 2 colors, rest as +N) #}
                  {% with colors=p.colors|default:None %}
                  <div class="aa-variants aa-swatches">
                    <div class="aa-swatch-wrap" aria-label="colors">
                      {% if colors and colors|length > 0 %}
                        <span class="aa-swatch aa-s1" style="--c: {{ colors.0.hex|default:'#111111' }};"></span>
                      {% else %}
                        <span class="aa-swatch aa-s1" style="--c:#111111"></span>
                      {% endif %}
                      {% if colors and colors|length > 1 %}
                        <span class="aa-swatch aa-s2" style="--c: {{ colors.1.hex|default:'#1E56D9' }};"></span>
                      {% else %}
                        <span class="aa-swatch aa-s2" style="--c:#1E56D9"></span>
                      {% endif %}
                    </div>
                    {% if colors and colors|length > 2 %}
                      <span class="aa-more aa-more-strong">+{{ colors|length|add:"-2" }}</span>
                    {% endif %}
                  </div>
                  {% endwith %}
                </div>
              </div>
            </div>
          {% empty %}
            <p class="text-muted">No new products yet.</p>
          {% endfor %}
        </div>

    </div>
  </section>

  <style>
    :root{
    --ink:#0B0D11;
    --muted:#76808F;
    --paper:#fff;
    --pill:#FFC72C;
    --chip:#fefefe;
    --off:#0CAF60;
    --divider:#b7bbc0;
    --shadow:0 10px 28px rgba(16,24,40,.10);
    --radius:16px;
    --inner:14px;
  }

  .aa-grid{
    display: grid;
    grid-template-columns: repeat(auto-fill, minmax(232.19px, 1fr));
    gap: 40px;
    align-items: start;
  }

  .aa-232 .aa-media{ height:248px; }

  .aa-card, .aa-card *{
    font-family: 'Inter', system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif;
    -webkit-font-smoothing: antialiased;
    -moz-osx-font-smoothing: grayscale;
  }

  .aa-card.aa-232{
    width:232.19px;
    background:var(--paper);
    border-radius:var(--radius);
    box-shadow:var(--shadow);
    overflow:hidden;
    border:1px solid #F1F3F5;
    transition:transform .18s ease, box-shadow .18s ease;
  }
  .aa-elev:hover{ transform:translateY(-2px); box-shadow:0 14px 32px rgba(16,24,40,.14); }

  .aa-232 .aa-media{
    position:relative;
    width:232.19px; height:232.19px;
    overflow:hidden;
    border-bottom:1px solid #F1F3F5;
    background:#0e0f12;
    border-radius: 0 0 14px 14px;
  }
  .aa-232 .aa-img{
    width:100%; height:100%; object-fit:cover; display:block;
    border-top-left-radius:var(--inner);
    border-top-right-radius:var(--inner);
    border-bottom-right-radius:var(--inner);
    border-bottom-left-radius:var(--inner); 
  }

  .aa-badge{
    position:absolute; top:0px; left:-4px;
    display:inline-flex; align-items:center; gap:6px;
    padding:2px 10px;
    background:#0C0C0C;
    color:#fff; font-weight:500; font-size:10px; line-height:1;
    border-radius: 0 0 6px 6px;
    box-shadow:0 2px 8px rgba(0,0,0,.25);
  }
  .aa-badge-emoji{ font-size:14px; line-height:1; }

  .aa-band{
    position:absolute; left:0px; right:0px; bottom:-31px;top:219px ;
    background:var(--pill);
    display:flex; align-items:center; justify-content:space-between;
    padding:3px 10px;
    border-radius: 0 0 14px 14px;
    pointer-events:none;
  }
  .aa-band-text{ font-weight:800; font-size:12.5px; color:#3a2e00; letter-spacing:.1px; }
  .aa-chip{
    display:inline-flex; align-items:center; gap:6px;
    background:var(--chip);
    color:#1f2328; font-weight:800; font-size:12px;
    padding:5px 8px; border-radius:9px;
    pointer-events:auto;
  }
  .aa-star{ color:#FFB800; }

  .aa-232 .aa-info{
    width:232.18px; height:157px;
    padding:40px 12px 12px;
    box-sizing:border-box;
    display:flex; flex-direction:column; justify-content:space-between;
  }
  .aa-title{
    margin:0;
    color:var(--ink);
    font-weight:800; font-size:15.5px; line-height:1.3;
    max-height:40px; overflow:hidden;
    letter-spacing:.2px;
  }

  .aa-divider{
    height:1px; width:100%;
    background:linear-gradient(90deg,var(--divider) 60%, rgba(255,255,255,0) 0);
    background-size:8px 1px;
    background-repeat:repeat-x;
    margin:6px 0 4px;
  }

  .aa-price-row{ display:flex; align-items:flex-end; justify-content:space-between; gap:8px; }
  .aa-price{ font-size:18px; font-weight:700; color:var(--ink); letter-spacing:.2px; }
  .aa-sub{ margin-top:2px; display:flex; align-items:center; gap:10px; }
  .aa-mrp{ color:#98A2B3; text-decoration:line-through; font-size:13px; }
  .aa-off{ color:var(--off); font-weight:800; font-size:13px; }

  .aa-swatches{
    gap:6px;
  }

  .aa-swatch-wrap{
    position:relative;
    width:36px; height:22px;
  }

  .aa-swatch{
    position:absolute; top:50%;
    width:18px; height:18px; border-radius:50%;
    background: var(--c, #111);
    border:2px solid #E6EBF1;
    box-shadow: 0 0 0 1px rgba(17,24,39,.08);
    transform: translateY(-50%);
  }
  .aa-swatch.aa-s1{ left:0; z-index:1; }
  .aa-swatch.aa-s2{ left:12px; z-index:2; }

  .aa-more-strong{
    color:#3C4653;
    font-weight:700;
    font-size:14px;
    letter-spacing:.1px;
  }
  .loading {
      display: flex;
      justify-content: center;
      align-items: center;
      height: 200px;
      font-size: 16px;
      color: var(--muted);
  }

  .loading::after {
      content: '';
      width: 20px;
      height: 20px;
      border: 2px solid var(--muted);
      border-top-color: transparent;
      border-radius: 50%;
      animation: spin 0.8s linear infinite;
      margin-left: 10px;
  }

  @keyframes spin {
      to { transform: rotate(360deg); }
  }

  </style>

  <!-- Featured Product Section -->
  {% if featured_products %}
<section class="featured-section">
  <div id="featuredCarousel" class="carousel slide" data-bs-ride="carousel" data-bs-interval="5000">
    <div class="carousel-inner">
      {% for featured in featured_products %}
      <div class="carousel-item {% if forloop.first %}active{% endif %}">
        <div class="featured-container">
          <div class="featured-left">
            <div class="featured-image">
              <img src="{{ featured.image.url }}" alt="{{ featured.title }}">
            </div>
          </div>
          
          <div class="featured-right">
            <div class="featured-content">
              <h2 class="featured-title">{{ featured.title }}</h2>
              <p class="featured-description">
                {{ featured.description }}
              </p>
              <div class="featured-price">{{ featured.formatted_price }}</div>
              <a href="{{ featured.link_url }}" style="text-decoration: none;">
                <button class="featured-btn">Buy Now</button>
              </a>
            </div>
          </div>
        </div>
      </div>
      {% endfor %}
    </div>

    <!-- Carousel Controls (if more than 1 product) -->
    {% if featured_products|length > 1 %}
    <button class="carousel-control-prev" type="button" data-bs-target="#featuredCarousel" data-bs-slide="prev">
      <span class="carousel-control-prev-icon" aria-hidden="true"></span>
      <span class="visually-hidden">Previous</span>
    </button>
    <button class="carousel-control-next" type="button" data-bs-target="#featuredCarousel" data-bs-slide="next">
      <span class="carousel-control-next-icon" aria-hidden="true"></span>
      <span class="visually-hidden">Next</span>
    </button>

    <!-- Indicators -->
    <div class="carousel-indicators">
      {% for featured in featured_products %}
      <button type="button" data-bs-target="#featuredCarousel" 
              data-bs-slide-to="{{ forloop.counter0 }}" 
              {% if forloop.first %}class="active"{% endif %}></button>
      {% endfor %}
    </div>
    {% endif %}
  </div>
</section>
{% endif %}

  <!-- Warranty Section -->
  <section class="features_band">
    <div class="features_item">
      <img src="https://res.cloudinary.com/dxndvadjt/image/upload/v1765252499/quality_ain1dz.png" alt="High Quality">
      <h4 class="features_title">High Quality</h4>
      <p class="features_text">crafted from top materials</p>
    </div>

    <div class="features_item">
      <img src="https://res.cloudinary.com/dxndvadjt/image/upload/v1765252260/warranty_xm5adc.png" alt="Warranty Protection">
      <h4 class="features_title">Warranty Protection</h4>
      <p class="features_text">Over 2 years</p>
    </div>

    <div class="features_item">
      <img src="https://res.cloudinary.com/dxndvadjt/image/upload/v1765252307/box_mmfrvh.png" alt="Free Shipping">
      <h4 class="features_title">Free Shipping</h4>
      <p class="features_text">Order over ‚Çπ500 </p>
    </div>

    <div class="features_item">
      <img src="https://res.cloudinary.com/dxndvadjt/image/upload/v1765252338/customer_iotyyf.png" alt="24/7 Support">
      <h4 class="features_title">24 / 7 Support</h4>
      <p class="features_text">Dedicated support</p>
    </div>
  </section>

  <script>
  document.addEventListener('DOMContentLoaded', function() {
      const tabBtns = document.querySelectorAll('.tab-btn');
      const productsGrid = document.querySelector('.products-grid.aa-grid');
      
      tabBtns.forEach(btn => {
          btn.addEventListener('click', function() {
              tabBtns.forEach(b => b.classList.remove('active'));
              this.classList.add('active');
              
              const category = this.getAttribute('data-category') || '';
              productsGrid.innerHTML = '<div class="loading">Loading...</div>';
              
              fetch(`{% url 'filter_new_arrivals' %}?category=${encodeURIComponent(category)}`)
                  .then(response => response.json())
                  .then(data => {
                      if (data.success) {
                          productsGrid.innerHTML = data.html;
                      } else {
                          productsGrid.innerHTML = '<p class="text-muted">Failed to load products.</p>';
                      }
                  })
                  .catch(error => {
                      console.error('Error:', error);
                      productsGrid.innerHTML = '<p class="text-muted">Error loading products.</p>';
                  });
          });
      });
  });
  </script>

  {% endblock %}